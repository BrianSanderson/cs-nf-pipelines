//====================  Nextflow/Container Config  ==========

manifest {
    name = "chipseq"
    description = 'Pipeline for ChIP-Seq Samples. Adapted from: https://nf-co.re/chipseq, which is available under MIT License'
    author = 'Sai Lek, Copyright Jackson Laboratory 2022'
    version = "0.1.0"
}


// Default to Mouse, If gen_org == 'human' parameters are overwritten with values
// in the "Defaults for Human" section below

params {
  // Shared params
  gen_org = 'mouse' // human 
  extension='.fastq.gz'
  pattern="*_R{1,2}*"
  read_type = 'PE' // 'SE'
  concat_lanes = false

  // Reference fasta
  ref_fa = '/projects/omics_share/mouse/GRCm38/genome/sequence/ensembl/v102/Mus_musculus.GRCm38.dna.primary_assembly.fa'
  ref_fa_indices='/projects/omics_share/mouse/GRCm38/genome/indices/ensembl/v102/bwa/Mus_musculus.GRCm38.dna.primary_assembly.fa'

  // GTF & BED annotation
  gtf   = '/projects/omics_share/mouse/GRCm38/transcriptome/annotation/ensembl/v102/Mus_musculus.GRCm38.102.gtf'
  gene_bed = '/projects/omics_share/mouse/GRCm38/transcriptome/annotation/ensembl/v102/Mus_musculus.GRCm38.102.bed'


  // Global default params, used in configs

  // Options: Generic
  input = ''         
  fragment_size = 200
  fingerprint_bins = 500000

  // Not mandatory but permits the pipeline to run through peak-calling steps
  macs_gsize = 1.2e7

  // For speed to avoid CI time-out
  fingerprint_bins = 100
  blacklist   = ""

  // Trimming & Bismark Setting
  non_directional = ''

  // Trim-Galore settings.
  trimLength = '30'
  qualThreshold = '30'
  adapOverlap = '1'
  adaptorSeq = 'AGATCGGAAGAGC'

  // bwa parameters
  mismatch_penalty = ""
  bwa_min_score = false

  // samtools merge bam filter parameters
  keep_dups = false
  keep_multi_map = false

  // bamtools filter
  bamtools_filter_pe_config  = "$projectDir/bin/shared/bamtools/bamtools_filter_pe.json"
  bamtools_filter_se_config  = "$projectDir/bin/shared/bamtools/bamtools_filter_se.json"

  // preseq paramters
  skip_preseq = false

  // Options: Peaks
  narrow_peak = false
  broad_cutoff = 0.1
  macs_fdr = false
  macs_pvalue = false
  min_reps_consensus = 1
  save_macs_pileup = false
  skip_peak_qc = false
  skip_peak_annotation = false
  skip_consensus_peaks = false

  // Options: Differential analysis
  deseq2_vst = false
  skip_diff_analysis = false

  // MultiQC
  multiqc_config = "${projectDir}/bin/shared/multiqc/chipseq.yaml"

  tmpdir = "/fastscratch/${USER}"
}

if (params.gen_org=='human'){

  // Reference fasta
  params.ref_fa = '/projects/omics_share/human/GRCh38/genome/sequence/gatk/Homo_sapiens_assembly38.fasta'
  params.ref_fa_indices = '/projects/omics_share/human/GRCh38/genome/indices/gatk/bwa/Homo_sapiens_assembly38.fasta.64'

  // GTF & BED annotation
  params.gtf = '/projects/omics_share/human/GRCh38/transcriptome/annotation/ensembl/v104/Homo_sapiens.GRCh38.104.gtf' 
  params.gene_bed = '/projects/omics_share/human/GRCh38/transcriptome/annotation/ensembl/v104/Homo_sapiens.GRCh38.104.bed'
}
